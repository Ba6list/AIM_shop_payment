<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayPay支払い申請フォーム</title>
    <style>
        /* CSSは前回と同じなので省略。必要であれば前回の回答からコピーしてください */
        body { font-family: sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 20px auto; padding: 0 15px; background-color: #f7f7f7; }
        .container { background-color: #fff; padding: 20px 30px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #00b900; }
        .qr-code { text-align: center; margin: 20px 0; }
        .qr-code img { max-width: 250px; border: 1px solid #ddd; }
        .important-notice { background-color: #fffde7; border: 1px solid #ffc107; border-radius: 5px; padding: 15px; margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="number"], input[type="text"], input[type="email"], input[type="file"] { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background-color: #00b900; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; font-weight: bold; }
        button:hover { background-color: #00a300; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        #message { text-align: center; font-weight: bold; margin-top: 15px; }
    </style>
</head>
<body>

<div class="container">
    <h1>AIM shop決済サイト</h1>

    <div class="important-notice">
        <strong>【重要：お支払い手順】</strong><br>
        1. 下のQRコードをPayPayアプリで読み取り、送金を完了します。<br>
        2. **必ず決済完了画面のスクリーンショットを撮影してください。**<br>
        3. 下のフォームに必要事項とスクリーンショットを添付し、「支払い完了を通知する」ボタンを押してください。
    </div>

    <div class="qr-code">
        <p>↓こちらのQRコードから送金してください↓</p>
        <img src="img/QR.png" alt="PayPay QR Code">
        <p>※QRコードが機能しない場合こちらから支払いを完了してください。</p>
        <a href="https://qr.paypay.ne.jp/p2p01_mnY3qi5SCpzE9aTML">支払い</a>
        </div>

    <form id="payment-form">
        <div class="form-group">
            <label for="amount">支払い金額（円）</label>
            <input type="number" id="amount" name="amount" placeholder="PayPayで送金した金額を入力" required>
        </div>
        <div class="form-group">
            <label for="name">お名前</label>
            <input type="text" id="name" name="name" placeholder="Discord_ID" required>
        </div>
        <div class="form-group">
            <label for="screenshot">決済完了スクリーンショット</label>
            <input type="file" id="screenshot" name="screenshot" accept="image/*" required>
        </div>
        <button type="submit" id="submit-button">支払い完了を通知する</button>
    </form>
    <div id="message"></div>
</div>

<script>
    const form = document.getElementById('payment-form');
    const submitButton = document.getElementById('submit-button');
    const messageDiv = document.getElementById('message');

    form.addEventListener('submit', function(e) {
        e.preventDefault();

        submitButton.disabled = true;
        messageDiv.textContent = '画像をアップロード中です...';
        messageDiv.style.color = 'blue';

        const formData = new FormData(form);
        const fileInput = document.getElementById('screenshot');
        const file = fileInput.files[0];

        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const fileData = {
                    fileName: file.name,
                    mimeType: file.type,
                    data: e.target.result.split(',')[1] // Base64エンコードされたデータ部分
                };
                
                // フォームの他のデータとファイルデータをまとめる
                const postData = {
                    amount: formData.get('amount'),
                    name: formData.get('name'),
                    file: fileData
                };

                // ↓↓↓ Step 4で取得するウェブアプリURLに書き換えます ↓↓↓
                const gasUrl = 'YOUR_GOOGLE_APPS_SCRIPT_URL';
                // ↑↑↑ Step 4で取得するウェブアプリURLに書き換えます ↑↑↑

                fetch(gasUrl, {
                    method: 'POST',
                    body: JSON.stringify(postData),
                    headers: { 'Content-Type': 'application/json' },
                })
                .then(response => response.json())
                .then(data => {
                    if (data.result === 'success') {
                        form.reset();
                        messageDiv.textContent = '通知を送信しました！入金確認までしばらくお待ちください。';
                        messageDiv.style.color = 'green';
                    } else {
                        throw new Error(data.message || '不明なエラーが発生しました。');
                    }
                })
                .catch(error => {
                    messageDiv.textContent = 'エラーが発生しました：' + error.message;
                    messageDiv.style.color = 'red';
                })
                .finally(() => {
                    submitButton.disabled = false;
                });
            };
            reader.readAsDataURL(file);
        } else {
            messageDiv.textContent = 'ファイルが選択されていません。';
            messageDiv.style.color = 'red';
            submitButton.disabled = false;
        }
    });
</script>

</body>
</html>